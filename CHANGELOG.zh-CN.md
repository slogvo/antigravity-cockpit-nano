# 更新日志

简体中文 · [英文](CHANGELOG.md)

本文件记录 Antigravity Cockpit 扩展的所有重要变更。

格式参考 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)。

---

## [1.6.14]

### 新增
- **公告**：增强公告系统，支持显示图片（如二维码等）以及基于语言的内容精准投放。
- **公告**：添加 announcement.popup.clickToPreview 功能，点击公告图片可全屏预览。

## [1.6.13]

### 优化
- **自动唤醒**：新增自定义时间输入，并统一每日/每周预设时间
- **自动唤醒**：提升 Crontab 解析准确性并优化超长延迟调度

## [1.6.12]

### 优化
- **自动唤醒**：触发历史新增“手动/自动”标签，方便区分触发方式

## [1.6.11]

### 优化
- **公告**：优化公告列表和弹窗的交互体验

## [1.6.1]

### 修复
- **国际化**：优化翻译文件，修复部分文案问题

## [1.6.0]

### 新增
- **自动唤醒**：全新功能，支持定时向 AI 模型发送请求
  - 设置定时唤醒，提前触发配额重置周期
  - 支持每天、每周、间隔和高级 Crontab 调度模式
  - 多模型选择：自由选择要触发的模型
  - 触发历史记录，显示请求和响应内容（保留 7 天，最多 40 条）
  - 下次触发时间显示在主配额悬浮提示中
  - 使用 VS Code 内置的 Secret Storage API 安全存储授权凭证
  - 通过 Google OAuth 进行 API 授权
- **公告系统**：全新的远程公告通知系统
  - 支持动态推送新特性、重要通知和版本更新说明
  - 支持弹窗提醒、标记已读和通知中心历史查看

## [1.5.48]

### 修复
- **国际化**：修复部分文本未走翻译文件的问题

## [1.5.47]

### 修复
- **列表视图一致性**：更新列表视图以使用与卡片视图相同的“分组管理”逻辑，确保所有视图下的分组管理体验一致。

## [1.5.46]

### 新增
- **自定义分组**：新增「分组管理」弹框，支持手动管理分组
  - 创建、重命名、删除自定义分组
  - 支持多选添加/移除模型
  - 兼容的模型优先排序，不兼容的动态禁用
  - 「自动分组」按钮根据配额预填分组（使用投票机制保留现有分组名称）
  - 配额校验：只有配额和重置时间相同的模型才能归入同一分组
  - 配额变化导致不一致时，自动将不符合的模型移出分组（移除少数派，保留多数派）

### 改进
- **Toast 提示**：现在显示在所有弹框之上（z-index: 9999）
- **隐私**：遥测和错误上报功能现在**默认关闭**。如果用户希望帮助改进插件，可以在设置中手动开启 (`agCockpit.telemetryEnabled`)。

## [1.5.45]

### 重构
- **错误处理**：引入 `AntigravityError` 类统一管理预期内错误（超时、服务端消息、启动检查）

## [1.5.44]

### 修复
- **启动保护**：禁止在系统就绪前（端口为0时）发起 API 请求，修复误报的 "Connection Refused (443)" 错误

## [1.5.43]

### 修复
- **代理绕过**：强制 localhost 连接绕过 HTTP 代理，修复用户开启全局代理导致的连接超时问题

## [1.5.42]

### 改进
- **错误上报**：服务端返回的错误（如"未登录"）不再上报到 Sentry

## [1.5.41]

### 改进
- **网络超时**：HTTP 请求超时时间从 5 秒增加到 10 秒，兼容 WSL2 等慢环境

## [1.5.40]

### 改进
- **自动拆分分组**：配额刷新时，自动拆分配额不一致的分组

## [1.5.39]

### 改进
- **错误上报**：仅上报启动阶段的错误；成功获取配额后，后续同步失败不再上报
- **服务端错误展示**：后端错误消息现在以"Antigravity 错误:"前缀透传给用户，而非显示笼统的"服务器响应无效"

## [1.5.38]

### 改进
- **错误上报**：新增匿名用户/会话标识与编辑器元信息，便于区分不同用户环境
- **诊断上下文**：上报中包含运行时限制与插件配置快照，提升定位效率
- **标签**：增加编辑器、URI Scheme 与 UI 类型标签，便于快速筛选
- **端口扫描**：上报扫描方式与端口验证信息，便于定位连接问题

## [1.5.37]

### 新增
- **错误上报**：轻量级匿名错误上报，帮助改进插件
  - 自动捕获并上报错误，加速问题修复
  - 尊重 VS Code 的全局遥测设置
  - 可通过 `agCockpit.telemetryEnabled` 设置关闭
  - 收集内容：错误堆栈、操作系统类型与版本、VS Code 版本、插件版本

## [1.5.36]

### 改进
- **Windows 进程检测**：重构检测逻辑，全面采用 PowerShell 并强制启用 UTF-8 编码。彻底解决了中文系统下的乱码报错问题，并移除了对已弃用 `wmic` 工具的依赖。
- **连接稳定性**：将 PowerShell 连接超时时间从 8 秒增加至 15 秒，以更好地兼容冷启动耗时较长的环境。

## [1.5.35]

- 修复：修复了启动时的 'Unexpected end of JSON input' 错误，增加了自动恢复机制
- 优化：增强了 API 响应错误的诊断日志

## [1.5.34]

### 改进
- **剩余时间显示**：自适应时间格式，提升可读性
  - 小于 60 分钟：`Xm`（如 `45m`）
  - 小于 24 小时：`Xh Ym`（如 `4h 57m`）
  - 大于等于 24 小时：`Xd Yh Zm`（如 `1d 2h 30m`）

## [1.5.33]

### 修复
- **数据遮罩**：修复 `package.json` 中缺少 `agCockpit.dataMasked` 配置声明的问题，导致"隐藏数据"按钮点击无效。

## [1.5.32]

### 修复
- **翻译键错误**：修复状态栏控制器中使用了错误的翻译键 `status.error`，更正为 `statusBar.error`。
- **数据遮罩持久化**：计划详情中的"隐藏数据"状态现在可以在关闭和重新打开 Dashboard 后保持。
- **变量声明顺序**：将 `isProfileHidden` 和 `isDataMasked` 声明移到 dashboard.js 顶部，优化代码结构。

### 改进
- **用户体验**：将重置倒计时文案从"已恢复"改为"即将恢复"，更准确地反映配额恢复的延迟特性。
- **国际化**：更新了全部 14 种语言的 `dashboard.online` 翻译。

## [1.5.31]

### 修复
- **内存泄漏**：修复日志服务中事件监听器未正确清理的问题，现已在销毁时正确释放配置变化监听器。
- **重复通知**：移除 ReactorCore 中重复的配额通知逻辑，通知功能现统一由 TelemetryController 处理，避免用户收到重复通知。

### 改进
- **代码清理**：移除多个文件中未使用的变量和导入。

## [1.5.30]

### 新增
- **单元测试**: 集成 Jest 框架并添加进程检测逻辑测试。
- **自动化打包**: 切换构建流水线至 `esbuild`。

### 改进
- **构建体积**: VSIX 包体积从 216 KB 降至 162 KB。
- **清理**: 移除构建输出中的冗余历史文件。

## [1.5.23]

### 改进
- **进程检测**: 优化 Antigravity 进程检测逻辑，要求必须包含服务端口和 CSRF Token，移除不准确的路径匹配以消除误报。
- **体积优化**: 通过新增 `.vscodeignore` 排除源码、Source Map 和演示截图，插件包体积缩减约 67%。
- **工程化完善**: 修复所有 Lint 错误，更新 TS 配置以支持现代 ESM 导入语法。

### 修复
- **状态栏**: 修正状态栏悬浮预览中套餐名称的显示。

## [1.5.22]

### 修复
- **面板更新**：修复了自动刷新时若面板在后台，切换回来数据未更新的问题。
- **配额精度**：修复了仪表盘（列表视图）与状态栏配额百分比显示不一致的问题，现已统一为向下取整。

## [1.5.21]

### 改进
- **文档**：重写 README，整合功能列表

---

## [1.5.20]

### 新增
- **QuickPick 模式**：完整分组模式支持，与 Webview 分组功能一致
- **QuickPick 模式**：标题栏操作按钮（刷新、切换分组、日志、设置、Webview）
- **QuickPick 模式**：自动分组按钮（仅分组模式下显示）
- **QuickPick 模式**：每个模型/分组项的重命名和重置按钮
- **QuickPick 模式**：刷新冷却机制，防止频繁连续刷新

### 改进
- **QuickPick 模式**：操作从列表项移至标题栏按钮，界面更简洁
- **QuickPick 模式**：进度条和重置时间移至详情行，对齐更整齐
- **翻译**：为全部 13 种支持语言添加 QuickPick 专属翻译

### 修复
- **显示模式**：在 Webview 和 QuickPick 之间切换时分组状态正确保持

---

## [1.5.19]

### 改进
- **QuickPick 模式**：切换"固定到状态栏"时改为局部刷新，只更新被点击的项，不再重建整个列表
- **QuickPick 模式**：移除冗余的状态图标（对号/警告/错误），仅保留固定图标，界面更简洁

---

## [1.5.18]

### 改进
- **代码架构**：重构 `extension.ts` 为模块化控制器，提升可维护性和性能。
- **UI 对齐**：修复 Windows 平台下进度条对齐问题，改用跨平台兼容的方块字符。

## [1.5.17]

### 新增
- **列表视图模式**：新增表格样式的配额展示视图
  - 通过 设置 → 视图模式（卡片/列表）切换

---

## [1.5.16]

### 新增
- **多语言支持扩展**：国际化支持从 2 种语言扩展到 14 种语言
  - 🇺🇸 English (en) - 英语
  - 🇨🇳 简体中文 (zh-cn)
  - 🇯🇵 日本語 (ja) - 日语 - 新增
  - 🇪🇸 Español (es) - 西班牙语 - 新增
  - 🇩🇪 Deutsch (de) - 德语 - 新增
  - 🇫🇷 Français (fr) - 法语 - 新增
  - 🇧🇷 Português do Brasil (pt-br) - 巴西葡萄牙语 - 新增
  - 🇷🇺 Русский (ru) - 俄语 - 新增
  - 🇰🇷 한국어 (ko) - 韩语 - 新增
  - 🇮🇹 Italiano (it) - 意大利语 - 新增
  - 🇹🇼 繁體中文 (zh-tw) - 繁体中文 - 新增
  - 🇹🇷 Türkçe (tr) - 土耳其语 - 新增
  - 🇵🇱 Polski (pl) - 波兰语 - 新增
  - 🇨🇿 Čeština (cs) - 捷克语 - 新增

### 改进
- **模块化翻译**：重构国际化架构，使用独立翻译文件，便于维护
- **语言检测优化**：增强语言环境检测，支持语言变体的自动回退映射

---

## [1.5.15]

### 改进
- **模型能力展示**：新增模型能力悬浮提示，悬停模型名称即可查看详细能力。
- **智能分组兜底**：优化“自动分组”逻辑，增加兜底分组策略。

---

## [1.5.14]

### 改进
- **分组模式引导**：在分组模式顶部添加说明文案，引导用户使用自动分组和模式切换功能

## [1.5.13]

### 新增
- **首次启动自动分组**：当分组功能已启用但尚无分组映射时，首次启动自动计算并保存分组

---

## [1.5.12]

### 修复
- **状态颜色**：状态球颜色调整回更鲜艳的色调（使用终端/图表高亮色，替代较暗的图标色）

---

## [1.5.11]

### 新增
- **名称+数字模式**：新增状态栏格式 `Sonnet: 95%`（不带状态球）

### 变更
- **状态栏选择器**：从按钮组改为下拉框，界面更简洁
- **设置标题**：从"提醒设置"简化为"设置"
- **设置自动保存**：所有设置立即生效，无需手动保存
- **阈值自动调整**：超出范围的值自动调整为有效值

### 修复
- **设置弹框保持**：数据自动刷新时弹框不再关闭

---

## [1.5.1]

### 新增
- **重置名称按钮**：重命名弹框新增"重置"按钮，可快速恢复原始名称

### 修复
- **状态栏同步**：自定义模型名称现在会正确显示在状态栏中（非分组模式）

### 改进
- **主题适配**：使用 VS Code 主题变量适配颜色（Tooltip、语义色、标签等）

---

## [1.5.0]

### 新增
- **模型重命名**：在非分组模式下可以重命名单个模型（点击模型卡片上的 ✏️ 图标）
- **状态栏样式选择器**：在设置面板中提供 5 种状态栏显示模式
  - 仅图标（`🚀`）
  - 仅状态球（`🟢` | `🟡` | `🔴`）
  - 仅数字（`95%`）
  - 状态球+数字（`🟢 95%`）
  - 完整显示（`🟢 Sonnet: 95%`）- 默认

### 变更
- 设置面板新增状态栏样式选择器，支持实时预览
- 自定义模型名称跨会话持久化保存

---

## [1.4.24]

### 变更
- QuickPick 模式：使用 Emoji 图标，确保在所有主题下始终可见

---

## [1.4.23]

### 新增
- QuickPick 模式：添加「切换到 Webview 模式」按钮，方便切换显示模式

---

## [1.4.22]

### 新增
- QuickPick 兼容模式：使用 VSCode 原生 QuickPick API 替代 Webview
- 更好兼容 Webview 不受支持的环境
- 通过 `agCockpit.displayMode: "quickpick"` 配置启用
- 功能：查看所有模型配额、切换状态栏固定、刷新数据
- Webview 加载失败时自动引导用户切换到 QuickPick 模式

---

## [1.4.21]

### 变更
- 文档：拆分中英文 README 与更新日志，并加入语言切换链接
- 文档：以 Open VSX 徽章/链接作为主要分发渠道

---

## [1.4.20]

### 修复
- 修复启动时服务未就绪（500 错误）导致的 `Cannot read properties of undefined` 崩溃问题
- 添加服务器响应验证，提供更清晰的错误信息

### 新增
- 启动时自动重试机制：首次同步失败会自动重试最多 3 次

---

## [1.4.19]

### 安全
- 诊断日志中的敏感信息（csrf_token）脱敏处理，防止信息泄露

---

## [1.4.18]

### 新增
- 创建独立的 `CHANGELOG.md` 文件，记录所有历史版本更新

### 变更
- README 中的 Changelog 章节改为引用独立文件
- 移除冗余的 `activationEvents` 配置（VS Code 自动生成）

---

## [1.4.17]

### 新增
- 启动日志中显示插件版本号，方便问题排查

---

## [1.4.16]

### 修复
- 优化进程识别逻辑，精准匹配 Antigravity 进程
- 避免误识别 Windsurf 等其他编辑器进程
- 强制要求 `--app_data_dir antigravity` 参数或路径包含 `antigravity`

---

## [1.4.15]

### 修复
- 修复所有 ESLint 错误（23 个错误 → 0）
- 将 `require()` 改为 ES6 动态 `import()`
- 为 case 块添加花括号作用域
- 修复 TypeScript `any` 类型警告

### 改进
- 增强 Windows 进程检测容错性
- 添加 PowerShell/WMIC 双向自动切换机制
- 添加切换次数限制防止无限循环
- PowerShell 冷启动等待时间从 1秒 增加到 2秒
- 检测 PowerShell 执行策略和 WMI 服务问题
- 增强诊断信息，提供用户友好的故障排除提示

---

## [1.4.14]

### 修复
- 修复多进程场景下的进程检测问题
- 改进进程验证逻辑

---

## [1.4.13]

### 变更
- 分组重命名改用模态框输入
- 移除仪表盘中的"最后更新时间"显示

---

## [1.4.12]

### 修复
- 修复 PowerShell 冷启动超时问题
- 增加进程命令执行超时时间至 8 秒

---

## [1.4.11]

### 变更
- 版本号整理

---

## [1.4.1]

### 新增
- 添加阈值通知开关，支持用户控制是否弹窗提醒

### 修复
- 修复通知开关状态未正确传递到前端的问题
- 修复点击状态栏和刷新缓存时阈值颜色判断错误的问题

---

## [1.4.0]

### 新增
- 可配置的警告/危险阈值
- 快捷键支持（查看日志、打开仪表盘等）
- 反馈入口（GitHub Issues）
- 阈值通知功能

### 改进
- 优化配额判断逻辑
- 统一颜色显示标准

---

## [1.3.14]

### 新增
- 添加备用关键字搜索（通过 `csrf_token` 查找进程）

### 修复
- 修复 PowerShell 引号转义问题

---

## [1.3.12]

### 修复
- 修正仪表盘状态逻辑
- 完善国际化支持
- Tooltip 中使用完整模型名称

---

## [1.3.1]

### 新增
- 状态栏彩色指示器（🟢🟡🔴）
- 统一的三色状态逻辑

### 改进
- 精度修复
- 工具提示模型顺序与仪表盘一致

---

## [1.3.0]

### 新增
- Tooltip 对齐优化
- 统一阈值配置
- 自动重试机制

---

## [1.2.16]

### 新增
- 首次切换到分组模式时自动分组

---

## [1.2.15]

### 新增
- 手动自动分组功能
- 持久化分组映射

---

## [1.2.13]

### 修复
- 确保自动置顶在 UI 刷新前执行

---

## [1.2.12]

### 修复
- 使用基于模型 ID 的稳定 groupId

---

## [1.2.11]

### 修复
- 多项改进和错误修复

---

## [1.2.1]

### 修复
- 首次启用分组时自动置顶所有分组

---

## [1.2.0]

### 新增
- 配额分组功能
- 分组自定义名称
- 分组拖拽排序
- 分组状态栏显示

---

## [1.1.153]

### 新增
- 使用趋势图可见性切换

---

## [1.1.152]

### 新增
- 配额历史图表（7 天数据保留）

---

## [1.1.151]

### 改进
- 简化用户资料控制
- 数据掩码改用文本按钮
- 可见性切换移至头部

---

## [1.1.150]

### 新增
- 用户资料可见性切换
- 敏感数据掩码功能

---

## [1.1.149]

### 新增
- 隐私模式
- 用户资料可见性切换

---

## [1.1.148]

### 修复
- 移除 Prompt Credits 设置
- 配置变更时自动更新状态栏

---

## [1.1.147]

### 修复
- 连接失败时自动重新扫描

---

## [1.1.146]

### 修复
- 状态栏错误状态未清除的问题

---

## [1.1.144]

### 变更
- 将"User ID"重命名为"Internal Tier ID"

---

## [1.1.143]

### 新增
- 详细用户资料字段本地化

---

## [1.1.142]

### 改进
- 上下文窗口逻辑移至固定区域

---

## [1.1.14]

### 新增
- 完整的用户资料详情
- 状态持久化

---

## [1.1.13]

### 改进
- 优化 UI 交互
- 修复置顶切换功能

---

## [1.1.12]

### 改进
- 增强调试日志
- 优化刷新行为

---

## [1.1.11]

### 修复
- 使用向下取整百分比，避免误导性的 100%

---

## [1.0.0]

### 新增
- 首次发布 🎉
- 沉浸式仪表盘
- 精确定时刷新
- 交互式控制（拖拽排序、置顶模型）
- 智能状态栏
- 智能通知
- 中英文双语支持
- 跨平台支持（Windows / macOS / Linux）
